<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BM Manager Market | Pi Ecosystem</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-purple: #6b21a8; --gold: #fbbf24; --deep-bg: #1a1a1a; }
        body { font-family: 'Cairo', sans-serif; background-color: #f3f4f6; margin: 0; overflow-x: hidden; }

        /* Ù…Ù†Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© */
        #pi-only-content { display: none; }
        #browser-warning { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; text-align: center; padding: 20px; }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø¨Ù‡Ø¬Ø© Ø±Ù…Ø¶Ø§Ù† 2026 */
        .ramadan-header {
            background: linear-gradient(135deg, var(--primary-purple), #4c1d95);
            color: white; padding: 40px 20px; text-align: center; position: relative;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4); border-bottom: 4px solid var(--gold);
        }
        .lantern { position: absolute; top: 10px; width: 50px; animation: swing 3s infinite ease-in-out; }
        @keyframes swing { 0%, 100% { transform: rotate(-15deg); } 50% { transform: rotate(15deg); } }
        
        .joy-timer { 
            background: rgba(255,255,255,0.15); border: 1px solid var(--gold);
            padding: 8px 20px; border-radius: 25px; color: var(--gold);
            font-weight: bold; margin-top: 15px; display: inline-block;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø¨ØµØ±ÙŠ */
        .scanner-box {
            width: 90%; max-width: 500px; margin: -30px auto 20px;
            background: #000; border-radius: 20px; overflow: hidden;
            position: relative; border: 3px solid white; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        #camera-preview { width: 100%; height: auto; display: block; transform: scaleX(1); }
        .overlay-text {
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6);
            color: var(--gold); padding: 5px 10px; border-radius: 5px; font-size: 0.8rem;
        }

        .btn-action {
            display: block; width: 85%; margin: 20px auto; padding: 18px;
            background: var(--gold); color: var(--primary-purple); border: none;
            border-radius: 15px; font-size: 1.2rem; font-weight: bold; cursor: pointer;
            box-shadow: 0 5px 15px rgba(251, 191, 36, 0.4);
        }
    </style>
</head>
<body>

    <div id="browser-warning">
        <img src="https://img.icons8.com/fluency/96/shield.png" alt="security">
        <h2 style="color: var(--primary-purple);">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† ÙÙ‚Ø·</h2>
        <p>Ø¹Ø°Ø±Ø§Ù‹ØŒ ØªØ·Ø¨ÙŠÙ‚ <b>BM Manager Market</b> ÙŠØ¹Ù…Ù„ Ø­ØµØ±ÙŠØ§Ù‹ Ø¯Ø§Ø®Ù„ Ù…ØªØµÙØ­ <b>Pi Browser</b> Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø£Ù…Ø§Ù† Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø±Ø§Øª.</p>
        <button onclick="location.reload()" style="padding: 10px 20px; border-radius: 10px; border: 1px solid #ccc;">Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„</button>
    </div>

    <div id="pi-only-content">
        <header class="ramadan-header">
            <img src="https://img.icons8.com/color/96/ramadan-lantern.png" class="lantern" style="right: 15px;">
            <img src="https://img.icons8.com/color/96/ramadan-lantern.png" class="lantern" style="left: 15px;">
            <h1 style="margin: 0; font-size: 1.8rem;">Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… 2026</h1>
            <p style="margin: 5px 0; opacity: 0.9;">Ù…Ø¨Ø§Ø±Ùƒ Ø¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø´Ù‡Ø± | BM Manager Market</p>
            <div class="joy-timer">â³ Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø£ÙŠØ§Ù… Ø§Ù„Ø¨Ù‡Ø¬Ø©: 35 ÙŠÙˆÙ…</div>
        </header>

        <div style="text-align: center; padding: 10px;">
            <div style="background: white; padding: 10px; border-radius: 10px; display: inline-block; border: 1px solid #ddd;">
                <span style="color: green;">â— Ø­Ø³Ø§Ø¨ Ù…Ø¤Ù…Ù†</span> | Ø§Ù„ØªØ§Ø¬Ø±: <span id="merchant-id">BM-PIONEER-2026</span>
            </div>
        </div>

        <div class="scanner-box">
            <div class="overlay-text">Ù†Ø¸Ø§Ù… SCP Ù†Ø´Ø· ğŸ›°ï¸</div>
            <video id="camera-preview" autoplay playsinline muted></video>
            <div id="placeholder" style="padding: 60px; text-align: center; color: white;">
                <img src="https://img.icons8.com/fluency/96/qr-code.png" width="60"><br>
                Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...
            </div>
        </div>

        <button class="btn-action" id="startBtn">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø¨ØµØ±ÙŠ Ø§Ù„Ø°ÙƒÙŠ (AR)</button>
        <p style="text-align: center; font-size: 0.8rem; color: #666;">ÙŠØ¬Ø¨ Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨ Ù„Ø¹Ù…Ù„ Ø§Ù„ÙƒØ´Ø§Ù ÙˆØ§Ù„Ù…Ø³ØªØ´Ø¹Ø±Ø§Øª</p>
    </div>

    <script>
        // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ (Pi Browser ÙÙ‚Ø·)
        const isPiBrowser = navigator.userAgent.includes("PiBrowser") || window.location.href.includes("pinet.com");
        
        if (isPiBrowser) {
            document.getElementById('browser-warning').style.display = 'none';
            document.getElementById('pi-only-content').style.display = 'block';
        }

        // 2. ÙƒÙˆØ¯ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„ÙƒØ´Ø§Ù (Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)
        const startBtn = document.getElementById('startBtn');
        const video = document.getElementById('camera-preview');
        const placeholder = document.getElementById('placeholder');

        startBtn.onclick = async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: "environment" },
                    audio: false
                });

                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    video.play();
                    placeholder.style.display = 'none';
                    activateTorch(stream);
                };
            } catch (err) {
                alert("Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· HTTPS (GitHub Pages) ÙˆÙ…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§.");
            }
        };

        // 3. Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ´Ø§Ù Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ©
        async function activateTorch(stream) {
            try {
                const track = stream.getVideoTracks()[0];
                const capabilities = track.getCapabilities();
                if (capabilities.torch) {
                    await track.applyConstraints({ advanced: [{ torch: true }] });
                    console.log("ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ´Ø§Ù");
                }
            } catch (e) { console.log("Ø§Ù„ÙƒØ´Ø§Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ Ø­Ø§Ù„ÙŠØ§Ù‹"); }
        }
    </script>
</body>
</html>
